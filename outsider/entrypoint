#!/usr/bin/env python3
"""Perform preparation needed to run any QA script."""
import os
import subprocess
import sys

import docker
import yaml

# Create the missing external networks
print(os.getcwd())
compose_contents = subprocess.check_output(["docker-compose", "config"])
compose_contents = yaml.safe_load(compose_contents)
client = docker.from_env()
for network in compose_contents.get("networks", {}).values():
    if network.get("external"):
        try:
            client.networks.get(network["name"])
        except docker.errors.NotFound:
            client.networks.create(network["name"])

# Continue with requested command
if sys.argv[1:]:
    os.execvp(sys.argv[1], sys.argv[1:])
